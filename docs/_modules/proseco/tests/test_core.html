
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>proseco.tests.test_core &#8212; proseco 5.10.1.dev3+g18daf21 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-astropy.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">Ska!</span><span id="logotext2">proseco</span><span id="logotext3"></span></a>
  <ul>
    
    <li><a class="home" title="Homepage" href="https://cxc.cfa.harvard.edu/mta/ASPECT/tool_doc">
        <span id="logotext1">ska</span><span id="logotext2">tools</span>
    </a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">proseco 5.10.1.dev3+g18daf21 documentation</a>
	 &#187;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for proseco.tests.test_core</h1><div class="highlight"><pre>
<span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>

<span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">import</span> <span class="nn">agasc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span>

<span class="kn">from</span> <span class="nn">proseco</span> <span class="kn">import</span> <span class="n">get_aca_catalog</span>

<span class="kn">from</span> <span class="nn">..acq</span> <span class="kn">import</span> <span class="n">AcqTable</span>
<span class="kn">from</span> <span class="nn">..characteristics</span> <span class="kn">import</span> <span class="n">bad_star_set</span>
<span class="kn">from</span> <span class="nn">..core</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ACABox</span><span class="p">,</span>
    <span class="n">StarsTable</span><span class="p">,</span>
    <span class="n">calc_spoiler_impact</span><span class="p">,</span>
    <span class="n">get_dim_res</span><span class="p">,</span>
    <span class="n">get_kwargs_from_starcheck_text</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..guide</span> <span class="kn">import</span> <span class="n">GuideTable</span>


<div class="viewcode-block" id="test_agasc_1p7"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_agasc_1p7">[docs]</a><span class="k">def</span> <span class="nf">test_agasc_1p7</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure that AGASC 1.7 is being used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Updated with APASS info</span>
    <span class="n">star</span> <span class="o">=</span> <span class="n">agasc</span><span class="o">.</span><span class="n">get_star</span><span class="p">(</span><span class="mi">688522864</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">star</span><span class="p">[</span><span class="s2">&quot;RSV3&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">star</span><span class="p">[</span><span class="s2">&quot;RSV2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11944</span>

    <span class="c1"># NOT updated with APASS info</span>
    <span class="n">star</span> <span class="o">=</span> <span class="n">agasc</span><span class="o">.</span><span class="n">get_star</span><span class="p">(</span><span class="mi">611193056</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">star</span><span class="p">[</span><span class="s2">&quot;RSV3&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">star</span><span class="p">[</span><span class="s2">&quot;RSV2&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9999</span></div>


<span class="k">def</span> <span class="nf">test_agasc_supplement</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bad_star_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3300</span>
    <span class="k">assert</span> <span class="mi">36178592</span> <span class="ow">in</span> <span class="n">bad_star_set</span>  <span class="c1"># From original starcheck list</span>
    <span class="k">assert</span> <span class="mi">658160</span> <span class="ow">in</span> <span class="n">bad_star_set</span>
    <span class="k">assert</span> <span class="mi">1248994952</span> <span class="ow">in</span> <span class="n">bad_star_set</span>


<div class="viewcode-block" id="test_box_init"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_box_init">[docs]</a><span class="k">def</span> <span class="nf">test_box_init</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ACABox initialization functionality&quot;&quot;&quot;</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">20</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="mi">20</span>

    <span class="n">box</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">20</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="mi">20</span>

    <span class="n">box</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">((</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">15</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="mi">10</span>

    <span class="n">box</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">15</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="mi">10</span>

    <span class="n">box2</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">box2</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">15</span>
    <span class="k">assert</span> <span class="n">box2</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="mi">10</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">ACABox</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="k">assert</span> <span class="s2">&quot;size arg must be&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_box_row_col_max"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_box_row_col_max">[docs]</a><span class="k">def</span> <span class="nf">test_box_row_col_max</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ACABox row, col properties and max() method&quot;&quot;&quot;</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">((</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">row</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">col</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">box</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">15</span></div>


<div class="viewcode-block" id="test_box_eq"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_box_eq">[docs]</a><span class="k">def</span> <span class="nf">test_box_eq</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ACABox equality and inequality&quot;&quot;&quot;</span>
    <span class="n">dither1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">dither3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">box1</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">(</span><span class="n">dither1</span><span class="p">)</span>
    <span class="n">box2</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">(</span><span class="n">dither1</span><span class="p">)</span>
    <span class="n">box3</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">(</span><span class="n">dither3</span><span class="p">)</span>

    <span class="c1"># ACABox to ACABox test</span>
    <span class="k">assert</span> <span class="n">box1</span> <span class="o">==</span> <span class="n">box2</span>
    <span class="k">assert</span> <span class="n">box1</span> <span class="o">!=</span> <span class="n">box3</span>

    <span class="c1"># Test against left and right sides that need conversion to ACABox first</span>
    <span class="k">assert</span> <span class="n">dither1</span> <span class="o">==</span> <span class="n">box1</span>
    <span class="k">assert</span> <span class="n">dither1</span> <span class="o">!=</span> <span class="n">box3</span>
    <span class="k">assert</span> <span class="n">box1</span> <span class="o">==</span> <span class="n">dither1</span>
    <span class="k">assert</span> <span class="n">box3</span> <span class="o">!=</span> <span class="n">dither1</span></div>


<div class="viewcode-block" id="test_box_add"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_box_add">[docs]</a><span class="k">def</span> <span class="nf">test_box_add</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ACABox left and right addition&quot;&quot;&quot;</span>
    <span class="n">box1</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

    <span class="n">box2</span> <span class="o">=</span> <span class="n">box1</span> <span class="o">+</span> <span class="mi">5</span>
    <span class="k">assert</span> <span class="n">box2</span> <span class="o">==</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

    <span class="n">box2</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">box1</span>
    <span class="k">assert</span> <span class="n">box2</span> <span class="o">==</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

    <span class="n">box2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">box1</span>
    <span class="k">assert</span> <span class="n">box2</span> <span class="o">==</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

    <span class="n">box2</span> <span class="o">=</span> <span class="n">box1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">box2</span> <span class="o">==</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_box_greater"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_box_greater">[docs]</a><span class="k">def</span> <span class="nf">test_box_greater</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ACABox &#39;greater than&#39; comparison&quot;&quot;&quot;</span>
    <span class="n">box1</span> <span class="o">=</span> <span class="n">ACABox</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

    <span class="c1"># True if either component of box1 is bigger than the test value</span>
    <span class="k">assert</span> <span class="n">box1</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">9.9</span><span class="p">,</span> <span class="mf">14.9</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">box1</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">9.9</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">box1</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">14.9</span><span class="p">)</span>

    <span class="k">assert</span> <span class="ow">not</span> <span class="n">box1</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">box1</span> <span class="o">&gt;</span> <span class="n">box1</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">box1</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">test_get_kwargs_from_starcheck_text</span><span class="p">():</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    OBSID: 21071  Kapteyn&#39;s Star         ACIS-S SIM Z offset:0     (0.00mm) Grating: NONE</span>
<span class="s2">    RA, Dec, Roll (deg):    77.976747   -45.066796    85.007351</span>
<span class="s2">    Dither: ON  Y_amp= 8.0  Z_amp= 8.0  Y_period=1000.0  Z_period= 707.1</span>
<span class="s2">    BACKSTOP GUIDE_SUMM OR MANVR DOT MAKE_STARS TLR</span>

<span class="s2">    MP_TARGQUAT at 2018:273:05:06:56.863 (VCDU count = 15011745)</span>
<span class="s2">      Q1,Q2,Q3,Q4: 0.30730924  0.61223190  0.22717786  0.69218737</span>
<span class="s2">      MANVR: Angle=  98.00 deg  Duration= 1967 sec  Slew err= 58.3 arcsec  End= 2018:273:05:39:39</span>

<span class="s2">    MP_STARCAT at 2018:273:05:06:58.506 (VCDU count = 15011751)</span>
<span class="s2">    ---------------------------------------------------------------------------------------------</span>
<span class="s2">     IDX SLOT        ID  TYPE   SZ   P_ACQ    MAG   MAXMAG   YANG   ZANG DIM RES HALFW PASS NOTES</span>
<span class="s2">    ---------------------------------------------------------------------------------------------</span>
<span class="s2">    [ 1]  0           1   FID  8x8     ---   7.000   8.000    922  -1737   1   1   25</span>
<span class="s2">    [ 2]  1           2   FID  8x8     ---   7.000   8.000   -773  -1741   1   1   25</span>
<span class="s2">    [ 3]  2           4   FID  8x8     ---   7.000   8.000   2140    166   1   1   25</span>
<span class="s2">    [ 4]  3   995373760   BOT  6x6   0.985   8.227   9.734    571   1383  32   1  180</span>
<span class="s2">    [ 5]  4  1058803776   BOT  6x6   0.985   8.591  10.094  -1871    288  28   1  160    a2</span>
<span class="s2">    [ 6]  5  1058806384   BOT  6x6   0.945   9.144  10.641  -1541   -971  28   1  160    a2</span>
<span class="s2">    [ 7]  6         ---   MON  8x8     ---     ---  13.938    500    500   6   0   20    mX</span>
<span class="s2">    [ 8]  7         ---   MON  8x8     ---     ---  13.938     66     31   3   0   20    mX</span>
<span class="s2">    [ 9]  6   995373040   ACQ  6x6   0.944   9.470  10.969    642   1162  23   1  135    a2</span>
<span class="s2">    [10]  7   995371984   ACQ  6x6   0.934   9.684  11.188    427    974  23   1  135    a2</span>
<span class="s2">    [11]  0   995369464   ACQ  6x6   0.925   9.398  10.906   1420     21  28   1  160    a2</span>
<span class="s2">    [12]  1  1058803424   ACQ  6x6   0.930   9.521  11.031  -1409   2023  26   1  150    a2</span>
<span class="s2">    [13]  2  1059724992   ACQ  6x6   0.848   9.989  11.500  -1271  -2201  20   1  120    a3</span>

<span class="s2">    &gt;&gt; INFO   : CCD temperature exceeds -10.9 C</span>
<span class="s2">    &gt;&gt; INFO   : Monitor window special commanding meets requirements</span>

<span class="s2">    Probability of acquiring 2,3, and 4 or fewer stars (10^x):	-6.191	-4.565	-3.180</span>
<span class="s2">    Acquisition Stars Expected  : 7.49</span>
<span class="s2">    Predicted Max CCD temperature: -10.6 C       N100 Warm Pix Frac 0.270</span>
<span class="s2">    Dynamic Mag Limits: Yellow 10.08     Red 10.22</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_kwargs_from_starcheck_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;obsid&quot;</span><span class="p">:</span> <span class="mi">21071</span><span class="p">,</span>
        <span class="s2">&quot;att&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">77.976747</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.066796</span><span class="p">,</span> <span class="mf">85.007351</span><span class="p">],</span>
        <span class="s2">&quot;man_angle&quot;</span><span class="p">:</span> <span class="mf">98.0</span><span class="p">,</span>
        <span class="s2">&quot;dither&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">),</span>
        <span class="s2">&quot;t_ccd&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">10.6</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2018:273:05:06:58.506&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_acq&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s2">&quot;n_guide&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;n_fid&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;detector&quot;</span><span class="p">:</span> <span class="s2">&quot;ACIS-S&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sim_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;focus_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;monitors&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">66</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">13.938</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">13.938</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span>
    <span class="p">}</span>
    <span class="k">assert</span> <span class="n">kwargs</span> <span class="o">==</span> <span class="n">exp</span>

    <span class="n">cat</span> <span class="o">=</span> <span class="n">get_aca_catalog</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mon</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">get_id</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">mon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">mon</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MON&quot;</span>
    <span class="k">assert</span> <span class="n">mon</span><span class="p">[</span><span class="s2">&quot;slot&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span>
    <span class="k">assert</span> <span class="n">mon</span><span class="p">[</span><span class="s2">&quot;yang&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">66.0</span>
    <span class="k">assert</span> <span class="n">mon</span><span class="p">[</span><span class="s2">&quot;zang&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">31.0</span>
    <span class="n">mon</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">get_id</span><span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="n">mon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">mon</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MON&quot;</span>
    <span class="k">assert</span> <span class="n">mon</span><span class="p">[</span><span class="s2">&quot;slot&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">mon</span><span class="p">[</span><span class="s2">&quot;yang&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">500.0</span>
    <span class="k">assert</span> <span class="n">mon</span><span class="p">[</span><span class="s2">&quot;zang&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">500.0</span>


<span class="k">def</span> <span class="nf">test_get_kwargs_from_starcheck_text2</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
    <span class="n">text2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    OBSID: 23156  WR 140                 ACIS-S SIM Z offset:0     (0.00mm) Grating: HETG</span>
<span class="s2">    RA, Dec, Roll (deg):   305.083054    43.865507   310.023234</span>
<span class="s2">    Dither: ON Y_amp= 8.0  Z_amp= 8.0  Y_period=1000.0  Z_period= 707.1</span>
<span class="s2">    BACKSTOP GUIDE_SUMM OR MANVR DOT MAKE_STARS TLR</span>

<span class="s2">    MP_TARGQUAT at 2020:337:13:05:57.809 (VCDU count = 14020378)</span>
<span class="s2">      Q1,Q2,Q3,Q4: -0.50382435  -0.11972583  -0.52770508  0.67331575</span>
<span class="s2">      MANVR: Angle=  93.34 deg  Duration= 1904 sec  Slew err= 54.5 arcsec  End= 2020:337:13:37:37</span>

<span class="s2">    MP_STARCAT at 2020:337:13:05:59.452 (VCDU count = 14020385)</span>
<span class="s2">    ---------------------------------------------------------------------------------------------</span>
<span class="s2">     IDX SLOT        ID  TYPE   SZ   P_ACQ    MAG   MAXMAG   YANG   ZANG DIM RES HALFW PASS NOTES</span>
<span class="s2">    ---------------------------------------------------------------------------------------------</span>
<span class="s2">    [ 1]  0           2   FID  8x8     ---   7.000   8.000   -773  -1741   1   1   25</span>
<span class="s2">    [ 2]  1           4   FID  8x8     ---   7.000   8.000   2140    166   1   1   25</span>
<span class="s2">    [ 3]  2           5   FID  8x8     ---   7.000   8.000  -1826    160   1   1   25</span>
<span class="s2">    [ 4]  3   414583264   BOT  6x6   0.981   7.693   9.203    697  -1232  28   1  160</span>
<span class="s2">    [ 5]  4   414583848   BOT  6x6   0.969   8.272   9.781   -443     34  28   1  160         C</span>
<span class="s2">    [ 6]  5   414585176   BOT  6x6   0.979   8.228   9.734   -958  -2143  28   1  160</span>
<span class="s2">    [ 7]  6   414718744   BOT  6x6   0.979   8.165   9.672  -1655   1816  28   1  160</span>
<span class="s2">    [ 8]  7   414725232   BOT  8x8   0.982   7.037   8.547     86     41  28   1  160</span>
<span class="s2">    [ 9]  0   414583128   ACQ  6x6   0.977   8.379   9.891  -2087   -459  28   1  160</span>
<span class="s2">    [10]  1   414588808   ACQ  6x6   0.973   8.665  10.172  -1596  -1891  28   1  160</span>
<span class="s2">    [11]  2   414724728   ACQ  6x6   0.967   8.961  10.469   1631   -790  28   1  160</span>

<span class="s2">    &gt;&gt; CAUTION : [ 7] Search spoiler.  414712192: Y,Z,Radial,Mag seps: 136 210 250 -0.7</span>
<span class="s2">    &gt;&gt; INFO    : [ 8] Appears to be MON used as GUI/BOT.  Has Magnitude been checked?</span>
<span class="s2">    &gt;&gt; INFO    : [ 8] Readout Size. 8x8 Stealth MON?</span>

<span class="s2">    Probability of acquiring 2 or fewer stars (10^-x):8.3110</span>
<span class="s2">    Acquisition Stars Expected  : 7.80</span>
<span class="s2">    Predicted Max CCD temperature: -11.2 C  N100 Warm Pix Frac 0.291</span>
<span class="s2">    Dynamic Mag Limits: Yellow 10.30  Red 10.56</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setenv</span><span class="p">(</span><span class="s2">&quot;PROSECO_OR_IMAGE_SIZE&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_kwargs_from_starcheck_text</span><span class="p">(</span><span class="n">text2</span><span class="p">,</span> <span class="n">force_catalog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_cat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cat_exp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">)</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;dither&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">),</span>
        <span class="s2">&quot;t_ccd&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">11.2</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2020:337:13:05:59.452&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_guide&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;detector&quot;</span><span class="p">:</span> <span class="s2">&quot;ACIS-S&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sim_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;focus_offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;obsid&quot;</span><span class="p">:</span> <span class="mi">23156</span><span class="p">,</span>
        <span class="s2">&quot;att&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">305.083054</span><span class="p">,</span> <span class="mf">43.865507</span><span class="p">,</span> <span class="mf">310.023234</span><span class="p">],</span>
        <span class="s2">&quot;man_angle&quot;</span><span class="p">:</span> <span class="mf">93.34</span><span class="p">,</span>
        <span class="s2">&quot;n_fid&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;include_ids_acq&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mi">414583264</span><span class="p">,</span>
            <span class="mi">414583848</span><span class="p">,</span>
            <span class="mi">414585176</span><span class="p">,</span>
            <span class="mi">414718744</span><span class="p">,</span>
            <span class="mi">414725232</span><span class="p">,</span>
            <span class="mi">414583128</span><span class="p">,</span>
            <span class="mi">414588808</span><span class="p">,</span>
            <span class="mi">414724728</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;n_acq&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s2">&quot;include_halfws_acq&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">160</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">160</span><span class="p">],</span>
        <span class="s2">&quot;include_ids_guide&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">414583264</span><span class="p">,</span> <span class="mi">414583848</span><span class="p">,</span> <span class="mi">414585176</span><span class="p">,</span> <span class="mi">414718744</span><span class="p">,</span> <span class="mi">414725232</span><span class="p">],</span>
        <span class="s2">&quot;include_ids_fid&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s2">&quot;monitors&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">86</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">7.037</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
    <span class="p">}</span>
    <span class="k">assert</span> <span class="n">kwargs</span> <span class="o">==</span> <span class="n">exp</span>

    <span class="n">cat</span> <span class="o">=</span> <span class="n">get_aca_catalog</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">cat</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="n">cat_exp</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;sz&quot;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">==</span> <span class="n">cat_exp</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>


<span class="n">cases</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mag0</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">mag1</span><span class="o">=</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="mf">0.16</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">)),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mag0</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">mag1</span><span class="o">=</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="mf">0.43</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">1.10</span><span class="p">)),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mag0</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">mag1</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="mf">2.37</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.98</span><span class="p">)),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mag0</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">mag1</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">)),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mag0</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">mag1</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mag0</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">mag1</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">)),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">mag0</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mag1</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="mf">0.34</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">)),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">col</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">mag0</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mag1</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="p">(</span><span class="mf">0.08</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">)),</span>
<span class="p">]</span>


<div class="viewcode-block" id="test_calc_spoiler_impact"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_calc_spoiler_impact">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;case&quot;</span><span class="p">,</span> <span class="n">cases</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_calc_spoiler_impact</span><span class="p">(</span><span class="n">case</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that calc_spoiler_impact gives reasonable answer.  See also:</span>
<span class="sd">    http://nbviewer.jupyter.org/url/asc.harvard.edu/mta/ASPECT/proseco/spoiler-impact.ipynb</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stars</span> <span class="o">=</span> <span class="n">StarsTable</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>
    <span class="n">stars</span><span class="o">.</span><span class="n">add_fake_star</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="s2">&quot;mag0&quot;</span><span class="p">])</span>
    <span class="n">stars</span><span class="o">.</span><span class="n">add_fake_star</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="s2">&quot;row&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="s2">&quot;col&quot;</span><span class="p">],</span> <span class="n">mag</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="s2">&quot;mag1&quot;</span><span class="p">])</span>
    <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">calc_spoiler_impact</span><span class="p">(</span><span class="n">stars</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stars</span><span class="p">)</span>
    <span class="c1"># print(f&#39;({dy:.2f}, {dz:.2f}, {f:.2f})&#39;)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">case</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span> <span class="n">case</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">case</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_calc_spoiler_impact_21068"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_calc_spoiler_impact_21068">[docs]</a><span class="k">def</span> <span class="nf">test_calc_spoiler_impact_21068</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Confirm that for the Dragonfly-44 field that the impact of the spoiler</span>
<span class="sd">    is acceptable and the star can be used as a candidate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># These values are taken from the stars table for 21068.</span>
    <span class="n">stars</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;row col mag id&quot;</span><span class="p">,</span> <span class="s2">&quot;-366.63 -92.75  8.73 1&quot;</span><span class="p">,</span> <span class="s2">&quot;-365.14 -92.93 10.52 2&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">calc_spoiler_impact</span><span class="p">(</span><span class="n">stars</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stars</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.5</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dz</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.5</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.95</span></div>


<div class="viewcode-block" id="test_mag_err_clip"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_mag_err_clip">[docs]</a><span class="k">def</span> <span class="nf">test_mag_err_clip</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test clipping magnitudes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Clipping case for star</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">StarsTable</span><span class="o">.</span><span class="n">from_agasc_ids</span><span class="p">(</span>
        <span class="n">att</span><span class="o">=</span><span class="p">[</span><span class="mf">6.88641501</span><span class="p">,</span> <span class="mf">16.8899464</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">agasc_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">154667024</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># s1[&#39;MAG_ACA_ERR&#39;] = 77 (0.77)</span>
    <span class="k">assert</span> <span class="n">s1</span><span class="p">[</span><span class="s2">&quot;COLOR1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.5</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="s2">&quot;mag_err&quot;</span><span class="p">],</span> <span class="mf">0.77</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">StarsTable</span><span class="o">.</span><span class="n">from_agasc_ids</span><span class="p">(</span>
        <span class="n">att</span><span class="o">=</span><span class="p">[</span><span class="mf">7.01214503</span><span class="p">,</span> <span class="mf">17.8931235</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">agasc_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">155072616</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># s1[&#39;MAG_ACA_ERR&#39;] = 9  (0.09)</span>
    <span class="k">assert</span> <span class="n">s1</span><span class="p">[</span><span class="s2">&quot;COLOR1&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.5</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="s2">&quot;mag_err&quot;</span><span class="p">],</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_alias_attributes"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_alias_attributes">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;cls&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">AcqTable</span><span class="p">,</span> <span class="n">GuideTable</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;attr&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;include_ids&quot;</span><span class="p">,</span> <span class="s2">&quot;exclude_ids&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_alias_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unit testing of descriptors, in particular the alias attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">exp</span> <span class="ow">in</span> <span class="p">((</span><span class="mf">2.2</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">==</span> <span class="n">exp</span>
        <span class="k">assert</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span> <span class="o">==</span> <span class="n">exp</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">==</span> <span class="n">exp</span>
        <span class="k">assert</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span> <span class="o">==</span> <span class="n">exp</span></div>


<div class="viewcode-block" id="test_pickle_stars"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_pickle_stars">[docs]</a><span class="k">def</span> <span class="nf">test_pickle_stars</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test that pickling a StarsTable object roundtrips&quot;&quot;&quot;</span>
    <span class="n">att</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">stars</span> <span class="o">=</span> <span class="n">StarsTable</span><span class="o">.</span><span class="n">from_agasc</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>
    <span class="n">stars2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">stars</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">stars2</span><span class="o">.</span><span class="n">att</span><span class="o">.</span><span class="n">equatorial</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">stars2</span><span class="o">.</span><span class="n">colnames</span> <span class="o">==</span> <span class="n">stars</span><span class="o">.</span><span class="n">colnames</span>
    <span class="k">assert</span> <span class="nb">repr</span><span class="p">(</span><span class="n">stars</span><span class="p">)</span> <span class="o">==</span> <span class="nb">repr</span><span class="p">(</span><span class="n">stars2</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_starstable_from_stars"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_starstable_from_stars">[docs]</a><span class="k">def</span> <span class="nf">test_starstable_from_stars</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test initializing a StarsTable from stars where att can be different.</span>

<span class="sd">    Tests with an attitude is 0.0005 arsec different (OK) and 0.002 arcsec</span>
<span class="sd">    different (not OK).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dang</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">/</span> <span class="mi">3600</span>  <span class="c1"># limit</span>
    <span class="n">att</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">359</span><span class="p">]</span>
    <span class="n">att2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">dang</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">359</span> <span class="o">-</span> <span class="mf">0.0005</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">att3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">dang</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">359</span> <span class="o">-</span> <span class="n">dang</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">stars</span> <span class="o">=</span> <span class="n">StarsTable</span><span class="o">.</span><span class="n">from_agasc</span><span class="p">(</span><span class="n">att</span><span class="o">=</span><span class="n">att</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">StarsTable</span><span class="o">.</span><span class="n">from_stars</span><span class="p">(</span><span class="n">att2</span><span class="p">,</span> <span class="n">stars</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;supplied att&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

    <span class="n">stars3</span> <span class="o">=</span> <span class="n">StarsTable</span><span class="o">.</span><span class="n">from_stars</span><span class="p">(</span><span class="n">att3</span><span class="p">,</span> <span class="n">stars</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">stars3</span> <span class="ow">is</span> <span class="n">stars</span></div>


<div class="viewcode-block" id="test_get_dim_res"><a class="viewcode-back" href="../../../unit_tests.html#proseco.tests.test_core.test_get_dim_res">[docs]</a><span class="k">def</span> <span class="nf">test_get_dim_res</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test getting ACA DIM and RES for an array of halfws&quot;&quot;&quot;</span>
    <span class="n">halfws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">337</span><span class="p">,</span> <span class="mi">338</span><span class="p">,</span> <span class="mi">420</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">exp_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">exp_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

    <span class="n">dim</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">get_dim_res</span><span class="p">(</span><span class="n">halfws</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span> <span class="o">==</span> <span class="n">exp_dim</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="n">exp_res</span><span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


<form action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2018, Tom Aldcroft, Jean Connelly.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 6.1.3. &nbsp;
  </p>
</footer>
  </body>
</html>