import numpy as np

# Nominal fid light positions on focal plane for each detector (y, z) in meters.

fidpos = {
    'HRC-S': [
        [0.0571252, 0.0227634],
        [-0.0595400, 0.0224085],
        [0.0572545, -0.0272881],
        [-0.0594729, -0.0274048],
    ],
    'HRC-I': [
        [0.0377667, 0.0635461],
        [-0.0406593, 0.0636239],
        [0.0586035, -0.0485306],
        [-0.0615813, -0.0484119],
    ],
    'ACIS-S': [
        [-0.0448963, 0.0845719],
        [0.0376268, 0.0847734],
        [-0.00194703, 0.0910544],
        [-0.104151, -0.0081088],
        [0.0888731, -0.0077944],
        [-0.0189102, -0.0391135],
    ],
    'ACIS-I': [
        [-0.0447620, 0.0410805],
        [0.0376852, 0.0413759],
        [-0.00180980, 0.0475558],
        [-0.104142, -0.0513726],
        [0.0889680, -0.0512821],
        [-0.0187749, -0.0826233],
    ],
}

# Turn into np arrays
for key, val in fidpos.items():
    fidpos[key] = np.array(val)


# Nominal TSC steps for each detector
simpos = {'HRC-S': -99612, 'HRC-I': -50505, 'ACIS-S': 75620, 'ACIS-I': 92905}

# Nominal focal length [m] for each detector
focal_length = {
    'HRC-S': 10.02773,
    'HRC-I': 10.031032,
    'ACIS-S': 10.037572,
    'ACIS-I': 10.037572,
}

# Preferred fid combinations (note subsequent processing in next block)
fid_sets = {
    'HRC-S': [[1, 2, 3], [1, 3, 4], [2, 3, 4], [1, 2, 4]],
    'HRC-I': [[1, 2, 3], [1, 3, 4], [2, 3, 4], [1, 2, 4]],
    'ACIS-I': [
        [1, 5, 6],
        [3, 5, 6],
        [1, 3, 5],
        [1, 3, 6],
        [1, 4, 5],
        [1, 2, 4],
        [1, 2, 5],
        [1, 2, 6],
        [1, 3, 4],
        [1, 4, 6],
        [2, 3, 4],
        [2, 3, 5],
        [2, 3, 6],
        [2, 4, 5],
        [2, 4, 6],
        [2, 5, 6],
        [3, 4, 5],
        [3, 4, 6],
        [4, 5, 6],
        [1, 2, 3],
    ],
    'ACIS-S': [
        [2, 4, 5],
        [3, 4, 5],
        [1, 4, 5],
        [1, 5, 6],
        [2, 4, 6],
        [3, 5, 6],
        [4, 5, 6],
        [2, 3, 4],
        [1, 2, 4],
        [1, 2, 5],
        [1, 2, 6],
        [1, 3, 4],
        [1, 3, 5],
        [1, 3, 6],
        [1, 4, 6],
        [2, 3, 5],
        [2, 3, 6],
        [2, 5, 6],
        [3, 4, 6],
        [1, 2, 3],
    ],
}

# Turn all the lists into set() objects for convenience
for detector in fid_sets:
    fid_sets[detector] = [set(fid_set) for fid_set in fid_sets[detector]]

# Nominal magnitudes for each fid light from Matlab tools characteristics.  SAUSAGE always
# commands 7.000, so not clear what is happening with these.
fid_mags = {
    'HRC-S': [7.1007, 7.1007, 7.0857, 7.1198],
    'HRC-I': [7.0749, 7.0830, 7.1159, 7.0806],
    'ACIS-S': [7.2531, 7.1778, 7.3382, 7.1966, 7.2168, 7.2696],
    'ACIS-I': [7.2531, 7.1778, 7.3382, 7.1966, 7.2168, 7.2696],
}

# Actual fid mag that is used in proseco calculations and outputs
fid_mag = 7.0

# The nominal focus position for each instrument
focus_pos = {'HRC-S': -991, 'HRC-I': -716, 'ACIS-S': -468, 'ACIS-I': -536}

# Sim translation step size in units of m / step
tsc_stepsize = 2.51432e-6

# Sim focus table.  Same as in the OFLS characteristics file.
focus_table = [
    [-11000, -0.01062],
    [-10900, -0.01058],
    [-10800, -0.01054],
    [-10700, -0.0105],
    [-10600, -0.01046],
    [-10500, -0.01042],
    [-10400, -0.01037],
    [-10300, -0.01033],
    [-10200, -0.01028],
    [-10100, -0.01023],
    [-10000, -0.01019],
    [-9900, -0.01014],
    [-9800, -0.01009],
    [-9700, -0.01004],
    [-9600, -0.00998],
    [-9500, -0.00993],
    [-9400, -0.00988],
    [-9300, -0.00982],
    [-9200, -0.00976],
    [-9100, -0.00971],
    [-9000, -0.00964],
    [-8900, -0.00959],
    [-8800, -0.00953],
    [-8700, -0.00946],
    [-8600, -0.0094],
    [-8500, -0.00933],
    [-8400, -0.00927],
    [-8300, -0.0092],
    [-8200, -0.00913],
    [-8100, -0.00907],
    [-8000, -0.00899],
    [-7900, -0.00892],
    [-7800, -0.00885],
    [-7700, -0.00878],
    [-7600, -0.0087],
    [-7500, -0.00863],
    [-7400, -0.00855],
    [-7300, -0.00847],
    [-7200, -0.00839],
    [-7100, -0.00831],
    [-7000, -0.00823],
    [-6900, -0.00815],
    [-6800, -0.00806],
    [-6700, -0.00798],
    [-6600, -0.00789],
    [-6500, -0.00781],
    [-6400, -0.00772],
    [-6300, -0.00763],
    [-6200, -0.00754],
    [-6100, -0.00745],
    [-6000, -0.00736],
    [-5900, -0.00726],
    [-5800, -0.00717],
    [-5700, -0.00707],
    [-5600, -0.00697],
    [-5500, -0.00688],
    [-5400, -0.00678],
    [-5300, -0.00668],
    [-5200, -0.00658],
    [-5100, -0.00648],
    [-5000, -0.00637],
    [-4900, -0.00627],
    [-4800, -0.00616],
    [-4700, -0.00606],
    [-4600, -0.00595],
    [-4500, -0.00584],
    [-4400, -0.00573],
    [-4300, -0.00562],
    [-4200, -0.00551],
    [-4100, -0.0054],
    [-4000, -0.00529],
    [-3900, -0.00517],
    [-3800, -0.00505],
    [-3700, -0.00494],
    [-3600, -0.00482],
    [-3500, -0.0047],
    [-3400, -0.00458],
    [-3300, -0.00446],
    [-3200, -0.00434],
    [-3100, -0.00427],
    [-3000, -0.0041],
    [-2900, -0.00397],
    [-2800, -0.00385],
    [-2700, -0.00372],
    [-2600, -0.00359],
    [-2500, -0.00347],
    [-2400, -0.00334],
    [-2300, -0.00321],
    [-2200, -0.00308],
    [-2100, -0.00295],
    [-2000, -0.00281],
    [-1900, -0.00268],
    [-1800, -0.00255],
    [-1700, -0.00241],
    [-1600, -0.00228],
    [-1500, -0.00214],
    [-1400, -0.002],
    [-1300, -0.00187],
    [-1200, -0.00173],
    [-1100, -0.00159],
    [-1000, -0.00145],
    [-900, -0.00131],
    [-800, -0.00116],
    [-700, -0.00102],
    [-600, -0.00088],
    [-500, -0.00073],
    [-400, -0.00059],
    [-300, -0.00044],
    [-200, -0.00029],
    [-100, -0.00015],
    [0, 0],
    [100, 0.00015],
    [200, 0.000297],
    [300, 0.00045],
    [400, 0.000599],
    [500, 0.000752],
    [600, 0.000904],
    [700, 0.001057],
    [800, 0.001212],
    [900, 0.001364],
    [1000, 0.001519],
    [1100, 0.001676],
    [1200, 0.001831],
    [1300, 0.001989],
    [1400, 0.002146],
    [1500, 0.002306],
    [1600, 0.002464],
    [1700, 0.002624],
    [1800, 0.002784],
    [1900, 0.002944],
    [2000, 0.003106],
    [2100, 0.003269],
    [2200, 0.003432],
    [2300, 0.003594],
    [2400, 0.003759],
    [2500, 0.003924],
    [2600, 0.004089],
    [2700, 0.004255],
    [2800, 0.00442],
    [2900, 0.004587],
    [3000, 0.004755],
    [3100, 0.004923],
    [3200, 0.005093],
    [3300, 0.00526],
    [3400, 0.005431],
    [3500, 0.005603],
    [3600, 0.005773],
    [3700, 0.005946],
    [3800, 0.006119],
    [3900, 0.006292],
    [4000, 0.006464],
    [4100, 0.00664],
    [4200, 0.006812],
    [4300, 0.00699],
    [4400, 0.007165],
    [4500, 0.007343],
    [4600, 0.007518],
    [4700, 0.007699],
    [4800, 0.007877],
    [4900, 0.008057],
    [5000, 0.008237],
    [5100, 0.008418],
    [5200, 0.008598],
    [5300, 0.008781],
    [5400, 0.008964],
    [5500, 0.009147],
    [5600, 0.009332],
    [5700, 0.009517],
    [5800, 0.009703],
    [5900, 0.009891],
    [6000, 0.010079],
    [6100, 0.010267],
    [6200, 0.010457],
]

# Margin from useable part of CCD for fid row / col [pixels]
# This includes 20 arcsec of position uncertainty + 5 pixels for readout HW + 2 pixels margin
ccd_edge_margin = 11  # pixels

# Margin from nominal fid position to possible spoiler star [arcsec].
# This includes 20" (4 pix) positional err + 4 pixel readout halfw +
# 2 pixel PSF of spoiler star = 10 pixels
spoiler_margin = 50  # arcsec

# Maximum hot pixel dark current which corresponds to a 1.5 arcsec FM centroid
# offset for a 7.0 mag fid with hot pixel location at the edge of the 8x8 box.
# This is the limit at which fid is rejected as a candidate if a pixel brighter
# than this limit is within the spoiler_margin.
hot_pixel_spoiler_limit = 10_500  # e-/sec
